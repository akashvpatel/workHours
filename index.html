<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Work Hours </title>
  <style>
    :root{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;margin:0}
    body{padding:20px;background:#f6f7fb;color:#111}
    .card{background:#fff;border-radius:10px;padding:18px;box-shadow:0 6px 20px rgba(19,24,40,0.06);max-width:900px;margin:0 auto}
    h1{margin:0 0 12px;font-size:20px}
    label{display:block;font-size:13px;margin-top:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    input,select,button{padding:8px 10px;border-radius:6px;border:1px solid #d7dbe6;background:#fff}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #eef1f6;text-align:left}
    .actions{display:flex;gap:8px;margin-top:12px}
    .muted{color:#556; font-size:13px}
    .output{white-space:pre-wrap;background:#f1f5ff;padding:12px;border-radius:8px;margin-top:12px;border:1px dashed #dbe6ff}
    .btn-primary{background:#1f6feb;color:#fff;border:none}
    .btn-danger{background:#ff6b6b;color:#fff;border:none}
    @media (max-width:640px){.row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="card">
    <h1>Work Hours</h1>
    <p class="muted">Add shifts (day, date, start & end time, place) and week range</p>

    <div class="row" style="align-items:center;margin-top:8px">
      <div style="flex:1;min-width:170px">
        <label for="weekStart">Week Start</label>
        <input id="weekStart" type="date" />
      </div>
      <div style="flex:1;min-width:170px">
        <label for="weekEnd">Week End</label>
        <input id="weekEnd" type="date" />
      </div>
    </div>

    <div class="row" style="align-items:center;margin-top:8px">
      <div style="flex:1;min-width:170px">
        <label for="date">Date</label>
        <input id="date" type="date" />
      </div>

      <div style="width:150px">
        <label for="day">Day</label>
        <select id="day">
          <option value="auto">(auto from date)</option>
          <option>Monday</option>
          <option>Tuesday</option>
          <option>Wednesday</option>
          <option>Thursday</option>
          <option>Friday</option>
          <option>Saturday</option>
          <option>Sunday</option>
        </select>
      </div>

      <div style="width:140px">
        <label for="start">Start time</label>
        <input id="start" type="time" />
      </div>

      <div style="width:140px">
        <label for="end">End time</label>
        <input id="end" type="time" />
      </div>

      <div style="width:160px">
        <label for="shift">Shift type</label>
        <select id="shift">
          <option>Morning shift</option>
          <option>Afternoon shift</option>
          <option>Night shift</option>
        </select>
      </div>

      <div style="width:160px">
        <label for="place">Place</label>
        <select id="place">
          <option>Bakery</option>
          <option>Warehouse</option>
        </select>
      </div>

    </div>

    <div class="actions">
      <button id="add" class="btn-primary">Add entry</button>
      <button id="clearAll" class="btn-danger">Clear all</button>
      <button id="copy" title="Copy formatted text">Copy text</button>
      <button id="download" title="Download as .txt">Download .txt</button>
    </div>

    <table id="entriesTable" style="display:none">
      <thead>
        <tr><th>Date</th><th>Day</th><th>Time</th><th>Shift</th><th>Place</th><th>Hours</th><th></th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="summary" style="margin-top:12px;display:none">
      <div class="output" id="formattedOutput"></div>
    </div>

  </div>

  <script>
    const $ = id => document.getElementById(id);
    let entries = [];

    function to12Hour(t) {
      if(!t) return '';
      const [hh, mm] = t.split(':').map(Number);
      const ampm = hh >= 12 ? 'pm' : 'am';
      const h12 = ((hh + 11) % 12) + 1;
      return h12 + (mm ? ':' + String(mm).padStart(2,'0') : '') + ' ' + ampm;
    }

    function minutesBetween(start, end) {
      const [sh, sm] = start.split(':').map(Number);
      const [eh, em] = end.split(':').map(Number);
      let s = sh * 60 + sm;
      let e = eh * 60 + em;
      if (e <= s) e += 24 * 60;
      return e - s;
    }

    function formatDateShort(d) {
      const dt = new Date(d);
      const day = String(dt.getDate()).padStart(2,'0');
      const month = String(dt.getMonth() + 1).padStart(2,'0');
      return `${day}/${month}`;
    }

    function getDayNameFromDate(d) {
      const dt = new Date(d);
      return dt.toLocaleDateString(undefined, { weekday: 'long' });
    }

    function render() {
      const tbody = document.querySelector('#entriesTable tbody');
      tbody.innerHTML = '';
      if (entries.length === 0) {
        $('entriesTable').style.display = 'none';
        $('summary').style.display = 'none';
        return;
      }
      $('entriesTable').style.display = '';

      let totalMin = 0;
      entries.forEach((en, idx) => {
        const tr = document.createElement('tr');
        const timeText = `${to12Hour(en.start)} to ${to12Hour(en.end)}`;
        const hrs = en.minutes / 60;
        totalMin += en.minutes;
        tr.innerHTML = `<td>${en.dateFormatted}</td><td>${en.day}</td><td>${timeText}</td><td>${en.shift}</td><td>${en.place}</td><td>${hrs}</td><td><button data-idx='${idx}'>Remove</button></td>`;
        tbody.appendChild(tr);
      });

      $('summary').style.display = '';

      const weekStart = $('weekStart').value ? formatDateShort($('weekStart').value) : 'Start';
      const weekEnd = $('weekEnd').value ? formatDateShort($('weekEnd').value) : 'End';

      const lines = [`Week: ${weekStart} - ${weekEnd}`];
      entries.forEach(en => {
        const dayShort = en.day;
        lines.push(`${dayShort} (${en.dateShort}) : ${en.minutes / 60} hours (${to12Hour(en.start)} to ${to12Hour(en.end)}), ${en.shift}, ${en.place}`);
      });

      const totalHours = totalMin / 60;
      lines.push(`\nTotal working hours are ${totalHours} hours.`);
      $('formattedOutput').innerText = lines.join('\n');

      document.querySelectorAll('#entriesTable button[data-idx]').forEach(btn => {
        btn.addEventListener('click', e => {
          const i = Number(e.target.dataset.idx);
          entries.splice(i,1);
          render();
        });
      });
    }

    $('date').addEventListener('change', e => {
      const v = e.target.value;
      if (!v) return;
      if ($('day').value === 'auto' || $('day').value === '') {
        const dayName = getDayNameFromDate(v);
        const opt = Array.from($('day').options).find(o => o.value === dayName);
        if(opt) $('day').value = dayName; else {
          const extra = document.createElement('option');
          extra.text = dayName; extra.value = dayName; extra.selected = true;
          $('day').appendChild(extra);
        }
      }
    });

    $('add').addEventListener('click', () => {
      const date = $('date').value;
      const start = $('start').value;
      const end = $('end').value;
      const shift = $('shift').value;
      const place = $('place').value;
      let day = $('day').value;
      if (!date || !start || !end) {
        alert('Please pick date, start and end times.');
        return;
      }
      if (day === 'auto') day = getDayNameFromDate(date);
      const minutes = minutesBetween(start, end);
      entries.push({
        dateISO: date,
        dateFormatted: new Date(date).toLocaleDateString(),
        dateShort: formatDateShort(date),
        day,
        start,
        end,
        shift,
        place,
        minutes
      });
      render();
    });

    $('clearAll').addEventListener('click', () => {
      if (!confirm('Clear all entries?')) return;
      entries = [];
      render();
    });

    $('copy').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText($('formattedOutput').innerText);
        alert('Copied to clipboard');
      } catch (e) {
        alert('Copy failed â€” select and Ctrl+C');
      }
    });

    $('download').addEventListener('click', () => {
      const blob = new Blob([$('formattedOutput').innerText], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'work-hours.txt'; a.click(); URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>

